
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>323 restriccions constraint - BD - Bases de Datos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#323-restriccions-constraint" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BD - Bases de Datos" class="md-header__button md-logo" aria-label="BD - Bases de Datos" data-md-component="logo">
      
  <img src="../../assets/logocaminas.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BD - Bases de Datos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              323 restriccions constraint
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BD - Bases de Datos" class="md-nav__button md-logo" aria-label="BD - Bases de Datos" data-md-component="logo">
      
  <img src="../../assets/logocaminas.png" alt="logo">

    </a>
    BD - Bases de Datos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Tema 1-Introducció
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Tema 1-Introducció
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/objectius/" class="md-nav__link">
        Objectius
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/1_fitxers_tradicionals/" class="md-nav__link">
        1. Fitxers tradicionals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/2_concepte_de_base_de_dades/" class="md-nav__link">
        2. Concepte de Base de Dades
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/3_caracterstiques_desitjables_dun_sgbd/" class="md-nav__link">
        3. Característiques desitjables d'un SGBD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/4_models_de_dades/" class="md-nav__link">
        4. Models de dades
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/5_arquitectura_a_3_nivells/" class="md-nav__link">
        5. Arquitectura a 3 nivells
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/6_llenguatges_del_sgbd/" class="md-nav__link">
        6. Llenguatges del SGBD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/7_classificacions_dels_sgbd/" class="md-nav__link">
        7. Classificacions dels SGBD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T01_Introduccio/autoavaluaci/" class="md-nav__link">
        Autoavaluació
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T02_Model_E-R/" class="md-nav__link">
        Tema 2-Model E/R
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T03_Model_Relacional/" class="md-nav__link">
        Tema 3- Model Relacional
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T04_Normalitzacio/" class="md-nav__link">
        Tema 4- Normalització
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T05_Annex_Base/" class="md-nav__link">
        Tema 5- Annex Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T05_Annex_Access/" class="md-nav__link">
        Tema 5- Annex Access
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T06_SQL_I_PostgreSQL/" class="md-nav__link">
        Tema 6- SQL I
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../BD-T06_SQL_II_PostgreSQL/" class="md-nav__link">
        Tema 6- SQL II]
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../(BD-T06_SQL_III_PostgreSQL/index.md" class="md-nav__link">
        Tema 6- SQL III
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../(BD-T07_PLpgSQL/index.md" class="md-nav__link">
        Tema 7- PLpgSQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../(BD-T08_BD_NoSQL/index.md)" class="md-nav__link">
        Tema 8- BD NoSQL
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p>Bases de Dades</p>
<ul>
<li><a href="../">Tema 6: SQL - DDL i consultes d'actualització (part III)</a></li>
<li><a href="../31_introducci/">3.1 Introducció</a></li>
<li><a href="../32_ddl/">3.2 DDL</a> </li>
<li><a href="../321_tipus_de_dades/">3.2.1 Tipus de dades</a></li>
<li><a href="../322_create_table/">3.2.2 CREATE TABLE</a> <ul>
<li><a href="../exercicis/">Exercicis</a></li>
</ul>
</li>
<li><a href="./">3.2.3 Restriccions (Constraint)</a> <ul>
<li><a href="../exercicis0/">Exercicis</a></li>
</ul>
</li>
<li><a href="../324_alter_table/">3.2.4 ALTER TABLE</a> <ul>
<li><a href="../exercicis1/">Exercicis</a></li>
</ul>
</li>
<li><a href="../325_drop_table/">3.2.5 DROP TABLE</a></li>
<li><a href="../326_ndex/">3.2.6 Índex</a> <ul>
<li><a href="../exercicis2/">Exercicis</a></li>
</ul>
</li>
<li><a href="../327_vistes/">3.2.7 Vistes</a> <ul>
<li><a href="../exercicis3/">Exercicis</a></li>
</ul>
</li>
<li><a href="../328_creaci_daltres_objectes_seqncies_dominis_i_tipus/">3.2.8. Creació d'altres objectes: seqüències, dominis i tipus.</a> <ul>
<li><a href="../3281_seqncies/">3.2.8.1 Seqüències</a></li>
<li><a href="../3282_dominis/">3.2.8.2 Dominis</a></li>
<li><a href="../3283_tipus_de_dades/">3.2.8.3 Tipus de dades</a></li>
</ul>
</li>
<li><a href="../33_consultes_dactualitzaci/">3.3 Consultes d'actualització</a> </li>
<li><a href="../331_insert/">3.3.1 INSERT</a> <ul>
<li><a href="../exercicis4/">Exercicis</a></li>
</ul>
</li>
<li><a href="../332_delete/">3.3.2 DELETE</a> <ul>
<li><a href="../exercicis5/">Exercicis</a></li>
</ul>
</li>
<li><a href="../333_update/">3.3.3 UPDATE</a> <ul>
<li><a href="../exercicis6/">Exercicis</a></li>
</ul>
</li>
<li><a href="../exercicis_de_tot_el_tema/">Exercicis de tot el tema</a></li>
</ul>
<p><a href="../exercicis/">« Anterior</a> | <a href="../exercicis0/">Següent »</a></p>
<h1 id="323-restriccions-constraint"><a name="main"></a><strong>3.2.3 Restriccions (Constraint)</strong></h1>
<p>Per mig de les restriccions podrem definir dins d'una taula restriccions d'usuari com són la definició de la clau principal, claus externes, camps no nuls i camps únics. </p>
<p>Hi ha dues maneres de definir restriccions: les que afecten a un únic camp (i que es posen en la mateixa definició del camp) i les que afecten o poden afectar a més d'un camp, que s'han de definir separadament de la definició dels camps. Comencem per les primeres, per ser més senzilles d'entendre: </p>
<p>Restriccions de camp únic</p>
<p>Són restriccions que es posen en la mateixa definició del camp i només afectaran a aquest camp: van per tant després del tipus de dades del camp i abans de la coma de separació dels camps.</p>
<p>La sintaxi és</p>
<p>[ CONSTRAINT nom ] {PRIMARY KEY | UNIQUE | NOT NULL | REFERENCES taula2 [(camp1)] | CHECK (<em>condició</em>)}</p>
<p>Si no posem nom a la restricció (CONSTRAINT nom) PostgreSQL li assignarà automàticament un nom. Açò pot resultar còmode en ocasions, per a no haver d'inventar-nos noms per a les restriccions, però després ens limitaria a que no podríem retocar aquestes restriccions.</p>
<p>Els tipus de restriccions que podem definir són:</p>
<ul>
<li><strong>PRIMARY KEY</strong>: el camp serà clau principal.</li>
</ul>
<p>Per exemple, d'aquesta manera definirem la taula EMPLEAT3 (com la de l'apartat anterior) amb el camp dni com a clau principal. Recordeu que l'heu d'esborrar primer (potser no l'estigueu visualitzant en pgAdmin, però sí que està creada; refresqueu constantment les taules per saber la situació actual)</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) CONSTRAINT cp_emp3 PRIMARY KEY, 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<p>Nota</p>
<p>Podeu comprovar que si no poseu nom a la restrició, és a dir si poseu directament dni <strong>TEXT(10) PRIMARY KEY</strong> , i aneu al disseny de la taula (fent-li clic des de pgAdmin; recordeu que heu de refrescar per a que apareguen els nous obectes), PostgreSQL posa automàticament un nom a la restricció format pel nom de la taula seguit de <strong>_pkey</strong>.</p>
<p>Tingueu en compte també que si la taula ja existia donarà un error. Només heu d'esborrar-la primer.</p>
<ul>
<li><strong>UNIQUE</strong>: el camp serà únic, és a dir, no es podrà agafar dues vegades el mateix valor en aquest camp (<em>Indexat sense duplicats</em> en Access). PostgreSQL generarà automàticament un índex per a aquest camp. Veurem què és un índex en la pregunta 3.2.6.</li>
</ul>
<p>Per exemple, d'aquesta manera definiríem la taula EMPLEAT3 amb la restricció que el camp <strong>nom</strong> no es pot repetir (si voleu provar la sentència feu-lo en la BD <strong>proves</strong>, i si ja existeix l'esborreu primer):</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR CONSTRAINT u_nom UNIQUE, 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<ul>
<li><strong>NOT NULL</strong>: el camp no podrà agafar un valor nul (<em>Requerido</em> en Access). Hem de ser conscients que no val la pena definir com a no nula la clau principal, ja que per definició ja ho és.</li>
</ul>
<p>Per exemple, d'aquesta manera definirem que el camp <strong>nom</strong> ha de ser no nul.</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR CONSTRAINT nn_nom NOT NULL , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<ul>
<li><strong>REFERENCES</strong>: servirà per a definir que aquest camp és una clau externa. Haurem d'especificar obligatòriament la taula a la qual apunta, i opcionalment podem posar entre parèntesis el camp de la taula al qual apunta, encara que si no ho posem, per defecte apuntarà a la clau principal (i nosaltres sempre voldrem apuntar a la clau principal).</li>
</ul>
<p>Per exemple, d'aquesta manera podem definir la clau externa que apunta a la taula DEPARTAMENT (i que indica que l'empleat pertany al departament). Abans de crear aquesta versió de EMPLEAT3, hem de tenir creada la taula DEPARTAMENT, sinó donarà error:</p>
<p>CREATE TABLE DEPARTAMENT
( num_d INT2 CONSTRAINT cp_dep PRIMARY KEY ,
<code></code>nom_d VARCHAR(50) ,
<code></code>director VARCHAR(10) ,
<code></code>data DATE );</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 CONSTRAINT ce_emp3_dep REFERENCES DEPARTAMENT ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE );</p>
<p>Com ja es va veure en el tema 3 (Model Relacional) i en el tema 5 (Access), hi ha 3 maneres d'actuar quan s'esborra o es modifica una fila de la taula principal que té associades files en la taula relacionada per mig de la clau externa. Per exemple, què fem amb els familiars d'un empleat si esborrem l'empleat? Aquestes maneres d'actuar s'han d'especificar en el moment de definir la clau externa. La manera de posar-les en SQL i el significat són les següents:</p>
<ul>
<li><strong>NO ACTION</strong>: no es deixarà esborrar o modificar de la taula principal si en té alguna fila relacionada. És l'opció per defecte. Així en l'exemple d'EMPLEAT3, amb una clau externa que apunta a DEPARTAMENT, si intentem esborrar o modificar el numero d'un departament que té empleats, ens donarà un missatge d'error, avisant que com té registres relacionats en una altra taula no es pot esborrar o modificar.</li>
<li><strong>CASCADE</strong>: s'esborraran (o modificaran) en cascada els registres relacionats de la taula on està la clau externa. S'especificarà amb <strong>ON DELETE CASCADE</strong> o <strong>ON UPDATE CASCADE</strong>. </li>
</ul>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 CONSTRAINT ce_emp3_dep REFERENCES DEPARTAMENT ON DELETE CASCADE ON UPDATE CASCADE ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<p>D'aquesta manera si esborrem un departament de la taula DEPARTAMENT, s'esborraran també els empleats de la taula EMPLEATS3 d'aquest departament. I si en la taula DEPARTAMENT modifiquem un número de departament, per exemple de 5 a 50, aquest valor serà el nou valor en el camp departament de la taula EMPLEAT3 per a aquells que abans teníen un 5.</p>
<ul>
<li><strong>SET NULL</strong>: posarà a nul el camp que és clau externa dels registres que estiguen relacionats amb l'esborrat o modificat de la taula principal. Així, si férem la següent definició de la taula EMPLEAT3 </li>
</ul>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 CONSTRAINT ce_emp3_dep REFERENCES DEPARTAMENT ON DELETE SET NULL ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<p>en el cas que esborrem el departament 5, no donaria cap error per aquesta restricció d'integritat, i posaria a nul el departament d'aquells empleats que abans eren del departament 5.</p>
<ul>
<li><strong>CHECK</strong>: farà una comprovació per a validar els valors introduïts per a aquest camp. La condició de validació ha d'anar entre parèntesis, i ha de ser una expressió, normalment de comparació del camp en qüestió amb algun valor.</li>
</ul>
<p>Per exemple, anem a exigir que el sou siga estrictament positiu (per tipus de dades numèric, podria agafar el valor 0 o valors negatius)</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) CONSTRAINT sou_positiu CHECK (sou &gt; 0), 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<p>Evidentment es pot posar més d'una restricció en la definició d'una taula. En aquest exemple arrepleguem totes les anteriors, és a dir, definim la taula <strong>EMPLEAT3</strong> amb tots els seus camps, i definint la <em>clau principal</em> (<strong>dni</strong>), amb el camp <strong>nom</strong> <em>únic</em>, amb el <strong>sou</strong> <em>estrictament positiu</em>, i amb el camp <strong>departament</strong> que serà <em>clau externa</em> que apunta a la taula DEPARTAMENT. Per complicar-lo un poc més també exigirem que el camp <strong>nom</strong> siga <em>no nul</em>, i així veure que es pot posar més d'una restricció en un camp.</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) CONSTRAINT cp_emp3 PRIMARY KEY , 
<code></code>nom VARCHAR CONSTRAINT u_nom UNIQUE CONSTRAINT nn_nom NOT NULL , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) CONSTRAINT sou_positiu CHECK (sou &gt; 0) , 
<code></code>departament INT2 CONSTRAINT ce_emp3_dep REFERENCES DEPARTAMENT ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE )</p>
<p>Observeu que com a qüestió d'estil s'han posat noms a les restriccions que d'alguna manera suggereixen el motiu de la restricció. Així, <strong>cp_emp3</strong> vol dir <em>clau princpal de EMPLEAT3</em>, <strong>u_nom</strong> vol dir que el camp <em>nom</em> és <em>únic</em>, <strong>nn_nom</strong> vol dir que <em>nom</em> és <em>no nul</em>, <strong>nn_sou</strong> vol dir que <em>sou</em> és <em>no nul</em>, i <strong>ce_emp3_dep</strong> vol dir <em>clau externa de la taula EMPLEAT3 a la taula DEPARTAMENT</em>. Si tenim un criteri clar per als noms de les restriccions, si després les volem desactivar temporalment o senzillament esborrar-les, ho podrem fer des de SQL.</p>
<p>Restriccions de camp múltiple</p>
<p>També s'anomenen restriccions de taula, en contraposició a les anteriors, que són restriccions de camp. Són restriccions que van dins de la definició d'una taula però fora de la definició d'un camp, i que poden afectar a un o més d'un camp. S'haurà de definir expressament a quin o quins camps afecten.</p>
<p>La sintaxi general, en aquesta ocasió és</p>
<p>[ CONSTRAINT nom ] {PRIMARY KEY | UNIQUE | FOREIGN KEY | CHECK (<em>condicio</em>)} (c11 [,c12][,...]) 
[ REFERENCES taula2 [ (c21 [,c22][,...]) ] ] 
[ ON DELETE {CASCADE | SET NULL}] [ON UPDATE {CASCADE | SET NULL}] ]</p>
<p>Igual que abans, si no posem nom a la restricció (CONSTRAINT nom) PostgreSQL li n'assignarà un automàticament, que serà construït de manera molt lògica.</p>
<p>Observeu que ara sempre especifiquem el o els camps afectats.</p>
<p>Els tipus de restriccions són els mateixos que en el cas anterior, però la sintaxi variarà lleugerament:</p>
<ul>
<li><strong>PRIMARY KEY</strong>: posarem entre parèntesis el camp o camps (en aquest cas separats per comes) que seran clau principal.</li>
</ul>
<p>Per exemple, definim una altra vegada el camp dni com a clau principal de la taula EMPLEAT3</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE , 
<code></code>CONSTRAINT cp_emp3 PRIMARY KEY (dni) )</p>
<p>I ara un altre per a definir la clau principal de FAMILIAR. Com la clau està formada per 2 camps, estem obligats a utilitzar una restricció de camp múltiple.</p>
<p>CREATE TABLE FAMILIAR
( dni VARCHAR(10), 
<code></code>nom VARCHAR, 
<code></code>data_n DATE, 
<code></code>parentesc VARCHAR(50), 
<code></code>CONSTRAINT cp_fam2 PRIMARY KEY (dni,nom) )</p>
<p>Com comentàvem, si la clau principal està formada per 2 camps estarem obligats a utilitzar una restricció de camp múltiple. Un <strong>error prou comú</strong> seria el següent:</p>
<p>CREATE TABLE FAMILIAR2
( dni VARCHAR(10) PRIMARY KEY, 
<code></code>nom VARCHAR PRIMARY KEY, 
<code></code>data_n DATE, 
<code></code>parentesc VARCHAR(50) )</p>
<p>Podeu comprovar que donarà <strong>error</strong>, perquè estem intentant definir 2 claus principals. La clau principal és única, això sí formada per 2 camps en aquesta ocasió.</p>
<ul>
<li><strong>UNIQUE</strong>: ara posarem entre parèntesis el o els camps que seran únics (en el seu conjunt). PostgreSQL generarà automàticament un índex per a aquesta combinació de camps. Veurem què és un índex en la pregunta 3.2.6.</li>
</ul>
<p>Per exemple, modifiquem la definició de EMPLEAT3 (anomenant-la EMPLEAT4) , amb un camp per als <strong>cognoms</strong> i un camp per al <strong>nom</strong>. Definirem la restricció que els camps cognoms i nom (en conjunt) no es poden repetir.</p>
<p>CREATE TABLE EMPLEAT4 
( dni VARCHAR(10), 
<code></code>cognoms VARCHAR, 
<code></code>nom VARCHAR, 
<code></code>data_naixement DATE, 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 , 
<code></code>CONSTRAINT u_nom4 UNIQUE (cognoms,nom) )</p>
<ul>
<li><strong>NOT NULL</strong>.</li>
</ul>
<p>No existeix aquesta opció com a restricció múltiple. Per tant s'ha de definir sempre com a restricció de camp únic.</p>
<ul>
<li><strong>FOREIGN KEY</strong>: servirà per a definir que aquest o aquestos camps són una clau externa. És la que més varia en la seua sintaxi, ja que hem d'especificar tant el o els camps d'aquesta taula que són clau externa, com la taula a la qual apunta (i en tot cas el o els camps on s'apunta, encara que si no ho posem apuntarà a la clau principal de l'altra taula, cosa que voldrem sempre):</li>
</ul>
<p>[CONSTRAINT nom] FOREIGN KEY (c11 [,c12][,...]) REFERENCES taula2 [(c21 [,c22][,...])] [ON DELETE {CASCADE | SET NULL}] [ON UPDATE {CASCADE | SET NULL}]</p>
<p>En l'exemple de la clau externa que apunta a la taula DEPARTAMENT quedarà així:</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE ,
<code></code>CONSTRAINT ce_emp3_dep FOREIGN KEY (departament) REFERENCES DEPARTAMENT )</p>
<ul>
<li><strong>CHECK</strong>: ara la condició de validació podrà afectar a més d'un camp</li>
</ul>
<p>Per exemple podríem exigir que la data d'incorporació siga estrictament posterior a la data de naixement</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) , 
<code></code>nom VARCHAR , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) , 
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE ,
<code></code>CONSTRAINT check_dates CHECK (data_incorporacio &gt; data_naixement) )</p>
<p>O una altra una miqueta més real, anem a agafar empleats de més de 18 anys, i per tant  anem a exigir que la data d'incorporació siga més de 18 anys posterior a la data de naixement. Per a això utilitzem la funció <strong>AGE(f1,f2)</strong> que calcula el temps entre la data d2 i la data d1 (que ha de ser la posterior), i d'ahí extraurem els anys amb <strong>EXTRACT(year FROM ...)</strong></p>
<p>CREATE TABLE EMPLEAT3
( dni VARCHAR(10) ,
<code></code>nom VARCHAR ,
<code></code>data_naixement DATE ,
<code></code>sou NUMERIC(6,2) ,
<code></code>departament INT2 ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' ,
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE ,
<code></code>CONSTRAINT check_dates 
<code></code>CHECK (EXTRACT(year FROM AGE(data_incorporacio,data_naixement) ) &gt;=18 ) )</p>
<p>Evidentment, es poden barrejar les restriccions de camp únic i les de camp múltiple. Ací en tenim un exemple on s'arrepleguen moltes (no totes) les restriccions anteriors. Hem posat de camp múltiple la dels 18 anys dels empleats, perquè no hi ha un altre remei, i també la de no repetició del camp <strong>nom</strong>, encara que podia ser de camp únic:</p>
<p>CREATE TABLE EMPLEAT3 
( dni VARCHAR(10) CONSTRAINT cp_emp3 PRIMARY KEY , 
<code></code>nom VARCHAR CONSTRAINT nn_nom NOT NULL , 
<code></code>data_naixement DATE , 
<code></code>sou NUMERIC(6,2) CONSTRAINT sou_positiu CHECK (sou &gt; 0) , 
<code></code>departament INT2 CONSTRAINT ce_emp3_dep REFERENCES DEPARTAMENT ,
<code></code>poblacio VARCHAR(50) DEFAULT 'Castelló' , 
<code></code>data_incorporacio DATE DEFAULT CURRENT_DATE ,
<code></code>CONSTRAINT u_nom3 UNIQUE (nom) , 
<code></code>CONSTRAINT check_dates 
<code></code>CHECK (EXTRACT(year FROM AGE(data_incorporacio,data_naixement) ) &gt;=18 ) )</p>
<p><a href="../exercicis/">« Anterior</a> | <a href="../exercicis0/">Següent »</a></p>
<p>Llicenciat sota la <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Llicència Creative Commons Reconeixement NoComercial CompartirIgual 3.0</a>
<strong>Created with an evaluation copy of Aspose.Words. To discover the full versions of our APIs please visit: https://products.aspose.com/words/</strong></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.indexes", "toc.integrate", "search.highlight", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>